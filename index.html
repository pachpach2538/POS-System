<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.9/html5-qrcode.min.js"></script>


    <style>
      
      body 
       <iframe style="width: 100%; height: 100vh;" scrolling="yes" src="https://script.google.com/macros/s/AKfycbz83bFpcJaahryBvsyi7LhOmzgWBSAYyx_9CqtLgav_UBM3beDoqWIARXHdUCozj9Za/exec" frameborder="0"></iframe>
      {
        font-family: sans-serif;
      }
////‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢//
.product-card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 0 3px rgba(0, 128, 0, 0.3);
  text-align: center;
  padding: 10px;
  box-sizing: border-box;
  border: 1px solid #4CAF50;
  transition: transform 0.2s ease;
}

.product-card img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  border-radius: 8px;
}
.product-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 10px;
  padding: 10px;
  margin-left: 10px;
  margin-right: 380px;
  box-sizing: border-box;

  height: calc(100vh - 200px); /* ‚úÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≠ */
  overflow-y: auto;            /* ‚úÖ ‡πÉ‡∏´‡πâ scroll ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô */
}
.cart {
  position: fixed;
  top: 0;
  right: 0;
  height: 100vh;
  width: 380px;
  background: #99FF99;
  color: black;
  padding: 20px 1cm 0 1cm;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}
/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡πÉ‡∏´‡πâ scroll ‡πÑ‡∏î‡πâ */
#cart-items {
  flex: 1;
  overflow-y: auto;
  margin-top: 10px;
  margin-bottom: 20px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏•‡πà‡∏≤‡∏á */
}
/* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏° */
.cart-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  padding-bottom: 10px;
}
.cart-buttons-wrapper {
  margin-top: auto;
}
      .remove-btn {
        background: red;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 2px 6px;
        margin-left: 10px;
        cursor: pointer;
      }

#payment-modal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 10px;
  z-index: 999;
  width: 90vw;
  max-width: 400px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ñ‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà */
  max-height: 90vh; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏•‡πâ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
  overflow-y: auto; /* ‡∏™‡∏£‡πâ‡∏≤‡∏á scroll bar ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô */
  box-sizing: border-box;
}

#payment-modal h3 {
  margin-top: 0;
  padding-top: 5px;
  font-size: 20px;
}
      #success-popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 2px solid #4caf50;
        border-radius: 12px;
        padding: 20px 30px;
        box-shadow: 0 0 15px rgba(0, 128, 0, 0.3);
        z-index: 9999;
        font-size: 24px;
        color: #333;
        text-align: center;
        max-width: 400px;
      }

      #cash-display {
        border: 1px solid #ccc;
        padding: 10px;
        font-size: 24px;
        width: 100%;
        text-align: right;
        background-color: #fff;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      #keypad {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px; /* üëà ‡∏•‡∏î‡∏à‡∏≤‡∏Å 10px ‡πÄ‡∏õ‡πá‡∏ô 6px */
  margin-top: 10px;
}

#keypad button {
  font-size: 16px;   /* üëà ‡∏à‡∏≤‡∏Å 20px ‡πÄ‡∏õ‡πá‡∏ô 16px */
  padding: 10px;     /* üëà ‡∏à‡∏≤‡∏Å 15px ‡πÄ‡∏õ‡πá‡∏ô 10px */
  border-radius: 10px;
  border: 1px solid #ccc;
  background-color: #fff;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

      #keypad button:hover {
  background-color: #f0f0f0;
}

#keypad .yellow {
  background-color: #ffcc00;
  color: #000;
  font-weight: bold;
}

#keypad .blue {
  background-color: #007bff;
  color: white;
  font-weight: bold;
}

#keypad .green {
  background-color: #4caf50;
  color: white;
}

#keypad .wide {
  grid-column: span 2;
}

#keypad .full-width {
  grid-column: span 4;
}

.pay-method {
  background: linear-gradient(to bottom, #d7ffd9, #a8e6af); /* ‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏° */
  border: 1px solid #999;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  min-width: 80px;
  transition: all 0.3s ease;
  flex: 1;
  font-weight: bold;
  color: #2e7d32;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.pay-method:hover {
  background: linear-gradient(to bottom, #b2fab4, #81c784);
  color: #1b5e20;
}

.pay-method.active {
  background: linear-gradient(to bottom, #4caf50, #388e3c);
  color: white;
}
     .product-card:hover {
  transform: scale(1.05);
  cursor: pointer;
}

@media (max-width: 768px) {
  .product-container {
    grid-template-columns: repeat(2, 1fr);
  }
}
@media (max-width: 480px) {
  .product-container {
    grid-template-columns: 1fr;
  }
}
@media (min-width: 1200px) {
  .product-container {
    grid-template-columns: repeat(6, 1fr);
  }
}
      .hidden {
        display: none;
      }
.pay-button {
  background-color: #28a745; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
  color: white;
  font-size: 0.55rem;
  padding: 1rem;
  width: 50%; /* ‡πÅ‡∏Ñ‡∏ö‡∏•‡∏á‡∏à‡∏≤‡∏Å 100% */
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: background-color 0.3s ease;
  display: block;
  margin: 0 auto; /* ‡∏à‡∏±‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
}

.pay-button:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #34c759, #1e7e34); /* ‡∏™‡∏µ‡∏™‡∏î‡∏Ç‡∏∂‡πâ‡∏ô */
  box-shadow: 0 6px 10px rgba(40, 167, 69, 0.4);
}
.pay-button {
  background-color: #28a745;
  color: white;
  font-size: 1.5rem;
  padding: 1rem;
  width: 100%;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  margin-top: 1rem;
}

.cash-input-container {
  position: relative;
  margin-bottom: 10px;
}

.cash-input-wrapper {
  position: relative;
  width: 100%;  
}
/// ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç//
.change-display {
  position: absolute;
  top: -30px;     /* üëà ‡∏Ç‡∏¢‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô */
  right: 0;
  font-size: 14px;
  background: white;
  padding: 2px 6px;
  border-radius: 6px;
  color: #CC0000;
  font-weight: bold;
  border: 1px solid #ccc;
}
.cart-buttons {
  display: flex;
  margin-top: 10px;
  gap: 10px;
}
/* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ */
#clear-cart {
  flex: 2;
  background: linear-gradient(135deg, #ff4e50, #f4364c); /* ‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡πÅ‡∏î‡∏á */
  color: white;
  font-size: 15px;
  padding: 10px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 6px rgba(255, 0, 0, 0.2);
  transition: all 0.3s ease;
}

#clear-cart:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #ff6a6a, #ff3d3d); /* ‡∏™‡∏µ‡∏≠‡πà‡∏≠‡∏ô‡∏•‡∏á */
  box-shadow: 0 6px 10px rgba(255, 0, 0, 0.3);
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏±‡∏Å‡∏ö‡∏¥‡∏• */
#hold-bill-btn {
  flex: 1;
  background: linear-gradient(135deg, #ffa500, #ff8c00); /* ‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏™‡πâ‡∏° */
  color: white;
  font-size: 1rem;
  padding: 10px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 6px rgba(255, 165, 0, 0.2);
  transition: all 0.3s ease;
}
/* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ö‡∏¥‡∏• */
#hold-bill-btn:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #ffbb33, #ff9900);
  box-shadow: 0 6px 10px rgba(255, 165, 0, 0.3);
}
#recall-bill-btn {
  flex: 1;
  background: linear-gradient(135deg, #007bff, #0056b3); /* ‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô */
  color: white;
  font-size: 1rem;
  padding: 10px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 6px rgba(0, 123, 255, 0.2);
  transition: all 0.3s ease;
}

#recall-bill-btn:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #3399ff, #004080);
  box-shadow: 0 6px 10px rgba(0, 123, 255, 0.3);
}

/// ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç///
.cancel-button {
  margin-top: 10px;
  display: block;
  background-color: #e53935;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
.cancel-button:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #c62828, #e53935); /* ‡∏™‡∏µ‡∏™‡∏î‡∏Ç‡∏∂‡πâ‡∏ô */
  box-shadow: 0 6px 10px rgba(40, 167, 69, 0.4);
}

/// ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç///
.payment-total-box {
  position: absolute;
  top: 10px;
  right: 20px;
  text-align: right;
  background-color: white;
  padding: 8px 12px;
  border-radius: 6px;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
}

.payment-total-box label {
  font-size: 16px;
  color: #000000;
}

.payment-total-box strong {
  font-size: 28px;
  font-weight: bold;
  color: #000000;
}
////‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤///
.total-box {
  margin-top: 15px;
  font-weight: bold;
  font-size: 16px;         /* ‚Üì ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏à‡∏≤‡∏Å 20px */
  background: #ffffff;
  color: #333;
  padding: 0.1px 0.1px;      /* ‚Üì ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î padding */
  border-radius: 0.5px;      /* ‚Üì ‡∏°‡∏∏‡∏°‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á */
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08); /* ‡∏•‡∏î‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡∏ô‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô */
  text-align: center;
  animation: fadeInScale 0.4s ease;
}

.total-box span {
  color: #d81b60;
  font-size: 20px;         /* ‚Üì ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
}

@keyframes fadeInScale {
  0% {
    opacity: 0;
    transform: scale(0.95);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}
.cart-divider {
  margin-bottom: -5px; /* ‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏£‡∏ß‡∏° */
}
///‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£///
#profit-summary {
  font-size: 12px;
  color: #888;
  text-align: right;
}
@media print {
  .no-print {
    display: none !important;
  }
}
/* ‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏®‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î ‡∏Ç‡∏≠‡∏á input[type=number] */
#manual-discount::-webkit-inner-spin-button,
#manual-discount::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

#manual-discount {
  -moz-appearance: textfield; /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Firefox */
}
@media print {
  #receipt-modal {
    background: white;
    padding: 0;
  }

  #receipt-content {
    width: 58mm;
    max-width: 58mm;
    font-size: 10pt;
    padding: 0;
    margin: 0 auto;
  }

  #receipt-content p {
    margin: 4px 0;
    text-align: left;
    font-family: monospace;
    white-space: pre-wrap;
  }

  #receipt-content hr {
    margin: 6px 0;
    border: none;
    border-top: 1px dashed #000;
  }

  .no-print,
  button {
    display: none !important;
  }

  body {
    margin: 0;
    padding: 0;
  }
}
//‡πÅ‡∏ñ‡∏ö‡∏ã‡πâ‡∏≤‡∏¢//
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 180px;
  height: 100vh;
  background: #99FF99;
  padding-top: 20px;
  box-sizing: border-box;
}

.sidebar button {
  display: block;
  width: 100%;
  padding: 10px 15px;
  margin: 5px 0;
  border: none;
  background: linear-gradient(to bottom, #ffffff, #e0e0e0); /* ‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏™‡∏µ */
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* ‡πÄ‡∏á‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
  text-align: left;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
}

.sidebar button:hover {
  background: linear-gradient(to bottom, #d0ffd0, #a0ffa0); /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô hover */
  box-shadow: 0 6px 10px rgba(0, 128, 0, 0.3); /* ‡πÄ‡∏á‡∏≤‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô */
  transform: translateY(-2px); /* ‡πÄ‡∏î‡πâ‡∏á‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢ */
}

.sidebar button.active {
  background: linear-gradient(to bottom, #4caf50, #388e3c); /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏° */
  color: white;
  box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
  transform: none; /* ‡πÑ‡∏°‡πà‡πÄ‡∏î‡πâ‡∏á‡πÅ‡∏ö‡∏ö hover */
}

.main-wrapper {
  margin-left: 180px; /* ‡πÄ‡∏ó‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á sidebar */
  padding: 20px;
  overflow-x: hidden; /* ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏•‡πâ‡∏ô‡∏Ç‡∏ß‡∏≤‡πÅ‡∏ö‡∏ö scroll */
}

//‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å//
.stock-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 12px;
  padding: 10px;
  margin-left: 10px;
  margin-right: 80px;
  box-sizing: border-box;
  height: calc(100vh - 200px); /* ‚úÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≠ */
  overflow-y: auto;            /* ‚úÖ ‡πÉ‡∏´‡πâ scroll ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô */
}

.stock-card {
  background: #fff;
  border: 1px solid #4CAF50;
  border-radius: 10px;
  box-shadow: 0 0 3px rgba(0, 128, 0, 0.2);
  text-align: center;
  padding: 10px;
  box-sizing: border-box;
  transition: transform 0.2s ease;
}

.stock-card img {
  width: 100%;
  height: 100px;
  object-fit: cover;
  border-radius: 8px;
}

.stock-card:hover {
  transform: scale(1.03);
}

.stock-name {
  font-size: 14px;
  font-weight: bold;
  margin-top: 4px;
}

.stock-qty {
  font-size: 13px;
  color: #444;
}



    </style>
  </head>

  <body>
    <!-- Top search bar -->
    <div style="background: #F5F5F5; padding: 8px 16px; margin-left: 180px;">
      <input
        type="text"
        id="searchInput"
        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ name/serial/barcode (Ctrl+f)"
        style="width: 50%; padding: 10px; border-radius: 6px; border: 3px solid #ccc; font-size: 16px;"
        onkeydown="if(event.key === 'Enter') searchAndAddToCart()"
      />
      <button onclick="searchAndAddToCart()" style="padding: 10px 16px; margin-left: 10px;">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>

  <!-- Sidebar -->
<!-- Sidebar -->
<div class="sidebar">
  <div style="padding: 10px; font-weight: bold;">üè™ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
  <!-- ‚úÖ ‡∏¢‡πâ‡∏≤‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô sidebar -->
<button id="btn-sale" onclick="showPage('sale')">üõçÔ∏è ‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</button>
<button id="btn-stock" onclick="showPage('stock')">üìÅ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
<button id="btn-report" onclick="showPage('report')">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</button>
</div>

  <!-- Main content -->
  <div class="main-wrapper">
    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢ -->
    <div id="section-pos">
      <h2>üõçÔ∏è ‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</h2>
      <div id="product-list" class="product-container"></div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å -->
<div id="stock-section" class="hidden" style="position: relative;">
  <h2 style="margin-right: 50px;">üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</h2>

 <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß -->
<button onclick="showBarcodeTypeModal()" style="
  position: absolute;
  top: 0;
  right: 60px;
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
  border-radius: 8px;
  padding: 10px 16px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0, 128, 0, 0.2);
  z-index: 1;
  transition: background 0.3s, transform 0.2s;
" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà"
  onmouseover="this.style.background='#bff0c8'"
  onmouseout="this.style.background='#d4edda'"
>
  ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
</button>

<div class="stock-container" id="stock-list"></div>
</div>


<!-- ‚úÖ Modal ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î -->
<div id="barcode-type-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
  background:white; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.2); z-index:9999; width:320px;">

  <h3 style="text-align:center; background:#339900; padding:10px; border-radius:8px;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</h3>
  <div style="margin-top:16px;">
    <label><input type="radio" name="barcode-option" value="no" checked> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</label><br>
    <label><input type="radio" name="barcode-option" value="yes"> ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</label>
  </div>

  <div id="barcode-scan-area" style="text-align:center; margin:20px 0;">
    <div id="scan-area" style="display:none; margin-bottom:10px;">
  <div id="reader" style="width:300px;"></div>
  <input id="manual-barcode" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î">
  <button onclick="startScan()">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô</button>
      <button onclick="stopScan()" style="margin-top:10px;">‚ùå ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
    </div>

    <button onclick="startScan()" style="background:#eee; border:none; padding:10px 20px; border-radius:6px;">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
    <div style="margin:10px 0;">‡∏´‡∏£‡∏∑‡∏≠</div>
    <input type="text" id="manual-barcode" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î" style="width:100%; padding:6px; text-align:center;">
  </div>

  <div style="display:flex; justify-content:space-between;">
    <button onclick="cancelBarcodeTypeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    <button onclick="confirmBarcodeType()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>
</div>



<!-- ‚úÖ Modal ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà -->
<div id="add-product-modal" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #f6fff7;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(0,0,0,0.2);
  z-index: 9999;
  width: 320px;
  font-family: 'Prompt', sans-serif;
  color: #333;
">
<!-- ‚úÖ Custom Alert Modal -->
<div id="custom-alert" style="
  display: none;
  position: fixed;
  top: 30%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 20px 30px;
  border-radius: 10px;
  box-shadow: 0 0 12px rgba(0,0,0,0.3);
  text-align: center;
  font-size: 16px;
  z-index: 9999;
">
  <div id="custom-alert-message" style="margin-bottom: 20px;"></div>
 <button onclick="submitNewProduct()" style="
    padding: 6px 14px;
    border: none;
    border-radius: 6px;
    background-color: #4CAF50;
    color: white;
    font-weight: bold;
    cursor: pointer;
  ">‡∏ï‡∏Å‡∏•‡∏á</button>
</div>

  <h3 style="margin-top:0; color: #228B22;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>

  <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
  <input type="text" id="new-name" style="width:100%; margin-bottom:8px; padding:6px; background:#f0fff4; border:1px solid #c3e6cb; border-radius:4px;"><br>

  <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢:</label>
  <input type="number" id="new-price" min="0" style="width:100%; margin-bottom:8px; padding:6px; background:#f0fff4; border:1px solid #c3e6cb; border-radius:4px;"><br>

  <label>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</label>
  <input type="number" id="new-cost" min="0" style="width:100%; margin-bottom:8px; padding:6px; background:#f0fff4; border:1px solid #c3e6cb; border-radius:4px;"><br>

  <label>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</label>
  <input type="number" id="new-quantity" min="0" style="width:100%; margin-bottom:8px; padding:6px; background:#f0fff4; border:1px solid #c3e6cb; border-radius:4px;"><br>

<label>‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î:</label>
<input type="text" id="new-barcode" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12345678" style="width:100%; margin-bottom:8px; padding:6px; background:#f0fff4; border:1px solid #c3e6cb; border-radius:4px;" readonly>
<div style="text-align:center; margin-bottom:8px;">
  <svg id="barcode-svg"></svg>
</div>

  <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</label>
  <input type="file" id="new-image-file" accept="image/*" style="width:100%; margin-bottom:12px;"><br>

  <div style="text-align:right;">
    <button onclick="submitNewProduct()" style="
      background:#28a745;
      color:white;
      border:none;
      padding:8px 16px;
      border-radius:6px;
      font-weight:bold;
      cursor:pointer;
    ">‚úÖ ‡∏ï‡∏Å‡∏•‡∏á</button>

    <button onclick="closeAddProductModal()" style="
      margin-left:10px;
      background:#dee2e6;
      color:#333;
      border:none;
      padding:8px 16px;
      border-radius:6px;
      font-weight:bold;
      cursor:pointer;
    ">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<!-- ‚úÖ ‡∏ã‡πà‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£ spinner ‡∏Ç‡∏≠‡∏á input type=number -->
<style>
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  input[type="number"] {
    -moz-appearance: textfield;
  }
</style>

<!-- ‚úÖ Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
<div id="edit-product-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#fff7f7; padding:20px; border-radius:12px; box-shadow:0 0 15px rgba(0,0,0,0.2); z-index:9999; width:320px;">

  <h3 style="color:#d9534f;">üõ† ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>

  <input type="hidden" id="edit-index" />
  <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
  <input type="text" id="edit-name" style="width:100%; margin-bottom:8px;"><br>

  <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢:</label>
  <input type="number" id="edit-price" style="width:100%; margin-bottom:8px;"><br>

  <label>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:</label>
  <input type="number" id="edit-cost" style="width:100%; margin-bottom:8px;"><br>

  <label>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</label>
  <input type="number" id="edit-quantity" style="width:100%; margin-bottom:8px;"><br>

<div style="display: flex; gap: 10px; margin-bottom: 8px;">
  <div style="flex: 1;">
    <label>‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤:</label>
    <input type="number" id="edit-in" value="0" oninput="updateStockPreview()" style="width: 100%;">
  </div>
  <div style="flex: 1;">
    <label>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å:</label>
    <input type="number" id="edit-out" value="0" oninput="updateStockPreview()" style="width: 100%;">
  </div>
</div>

  <label>‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î:</label>
  <input type="text" id="edit-barcode" style="width:100%; margin-bottom:8px;" readonly><br>

  <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô):</label>
  <input type="file" id="edit-image-file" accept="image/*" style="width:100%; margin-bottom:12px;"><br>

  <div style="text-align:right;">
    <button onclick="submitEditProduct()" style="background:#f0ad4e; color:white; border:none; padding:8px 16px; border-radius:6px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button onclick="closeEditProductModal()" style="margin-left:10px; background:#dee2e6; color:#333; padding:8px 16px; border-radius:6px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>


    <!-- ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô -->
    <div id="section-report" class="hidden">
      <h2>üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h2>
      <p>(‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° Google Sheet ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á)</p>
    </div>
  </div>

        <!-- ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
<div class="cart">
  <h3>üìë‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
  <div id="cart-items">
    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
</div>
<div id="profit-summary">
  ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span id="item-count">0</span> ‡∏ä‡∏ô‡∏¥‡∏î<br>
  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: <span id="product-quantity">0</span> ‡∏ä‡∏¥‡πâ‡∏ô
</div>
  
<!-- ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° -->
<div class="total-box">
  <hr />
  üí∏ ‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó
</div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ -->
  <div class="cart-buttons-wrapper">
    <button class="pay-button" onclick="showPaymentModal()">üí∞ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô üí∞</button>

    <div class="cart-buttons">
      <button id="clear-cart">‚úñ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚úñ</button>
      <button id="hold-bill-btn" onclick="holdBill()">üì• ‡∏û‡∏±‡∏Å‡∏ö‡∏¥‡∏• (<span id="hold-count">0</span>)</button>
      <button id="recall-bill-btn" onclick="showRecallBillPopup()">üì§ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ö‡∏¥‡∏•</button>
    </div>
  </div>
</div>

    <!-- Modal ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
    <div id="payment-modal">
      <h3>üö©‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô</h3>
      <div class="payment-total-box">
  <label>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <strong id="payment-total">0</strong> ‡∏ö‡∏≤‡∏ó</label>
</div>

<!-- ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î ‡∏Å‡∏î‡∏•‡∏î‡∏°‡∏∑‡∏≠ -->
<div class="cash-input-container">
  <label for="manual-discount">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î ‡∏Å‡∏î‡∏•‡∏î‡∏°‡∏∑‡∏≠ :</label>
  <div class="cash-input-wrapper">
    <input type="number" id="manual-discount" placeholder="0" min="0" style="width: 100%; font-size: 24px; padding: 6px; border-radius: 8px; text-align: left;">
    <span onclick="clearDiscount()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-weight: bold; color: goldenrod; cursor: pointer;">X</span>
  </div>
</div>

<div class="cash-input-container">
  <label>‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô:</label>
  <div class="cash-input-wrapper">
    <div id="cash-display"></div>
    <div class="change-display">‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô: ‡∏ø<span id="change-amount"></span></div>
  </div>
</div>

      <div id="keypad">
        <button onclick="appendDigit('7')">7</button>
        <button onclick="appendDigit('8')">8</button>
        <button onclick="appendDigit('9')">9</button>
        <button class="green" onclick="appendAmount(100)">100</button>

        <button onclick="appendDigit('4')">4</button>
        <button onclick="appendDigit('5')">5</button>
        <button onclick="appendDigit('6')">6</button>
        <button class="green" onclick="appendAmount(500)">500</button>

        <button onclick="appendDigit('1')">1</button>
        <button onclick="appendDigit('2')">2</button>
        <button onclick="appendDigit('3')">3</button>
        <button class="green" onclick="appendAmount(1000)">1000</button>

        <button onclick="appendDigit('0')">0</button>
        <button onclick="appendDigit('.')">.</button>
        <button class="yellow" onclick="clearCash()">‡∏•‡∏ö</button>
        <button class="green" onclick="payExact()">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏≠‡∏î‡∏µ</button>
        <button class="blue full-width" onclick="submitPayment()">‡∏ï‡∏Å‡∏•‡∏á</button>
      </div>

      <div style="text-align: left; margin-top: 1px;">
        <label>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:</label>
        <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-top: 5px;">
          <button class="pay-method active" data-method="‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
          <button class="pay-method" data-method="‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô">üí≥ ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>
      </div>

    <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° QR Modal -->
    <div id="promptpay-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; border-radius:12px; box-shadow:0 0 15px rgba(0,0,0,0.3); z-index:9999; text-align:center;">
      <h3>üî∂ ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô PromptPay</h3>
      <img id="promptpay-img" src="" width="200" alt="QR PromptPay">
      <p id="qr-amount" style="margin-top:10px; font-size:18px;"></p>
<button onclick="confirmPromptPayPayment()" style="margin-top:10px; padding:6px 16px; background:#f44336; color:white; border:none; border-radius:6px;">‚úÖ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>

    </div>

<button class="cancel-button" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>

    <!-- Success Popup -->
    <div id="success-popup">
      üü¢ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
      ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô: <span id="popup-change">0</span> ‡∏ö‡∏≤‡∏ó
    </div>

<!-- ‚úÖ ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<div id="receipt-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:10000; overflow:auto; padding:20px;">
  <div id="receipt-content" style="width: 100%; max-width: 58mm; margin: 0 auto; background: #fff; padding: 10px; border-radius: 0; font-family: monospace; font-size: 10pt;">
    <div style="text-align:center;">
      <img src="https://via.placeholder.com/100x50" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ" />
      <h3>‡∏ô‡∏±‡∏ô‡∏ó‡πå‡∏ï‡∏¥‡∏ç‡∏≤ ‡∏ú‡πâ‡∏≤‡∏ù‡πâ‡∏≤‡∏¢</h3>
      <p>Muang Tuet, Phu Phiang, Nan Thailand, 55000</p>
      <hr />
      <h4>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</h4>
    </div>
    <div id="receipt-details" style="font-size:14px;"></div>
    <hr />
<div style="text-align:right; font-size:14px; margin-top: 15px;">
  <p><strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> <span id="receipt-total"></span> ‡∏ö‡∏≤‡∏ó</p>
  <p><strong>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î:</strong> <span id="receipt-discount"></span> ‡∏ö‡∏≤‡∏ó</p>
  <p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</strong> <span id="receipt-nettotal"></span> ‡∏ö‡∏≤‡∏ó</p> <!-- ‚úÖ ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ -->
  <p><strong>‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô:</strong> <span id="receipt-received"></span> ‡∏ö‡∏≤‡∏ó</p>
  <p><strong>‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô:</strong> <span id="receipt-change"></span> ‡∏ö‡∏≤‡∏ó</p>
   <p><strong>‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞:</strong> <span id="receipt-method"></span></p>
</div>


    <div style="text-align:center; font-size:12px;">
      FB: ‡∏ô‡∏±‡∏ô‡∏ó‡πå‡∏ï‡∏¥‡∏ç‡∏≤ ‡∏ú‡πâ‡∏≤‡∏ù‡πâ‡∏≤‡∏¢ ‡∏ú‡πâ‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á<br/>
      ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡πÄ‡∏ü‡∏£‡∏°
    </div>
    <div style="margin-top:10px; text-align:center;">
<button class="no-print" onclick="printAndClose()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
<button class="no-print" onclick="downloadReceiptImageAndClose()">üñº ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ</button>

    </div>
  </div>
</div>

    <script>
      let selectedMethod = "‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î"; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ selectedMethod ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
      let cart = [];
      let cashReceived = "";
  
      

function renderProducts(products) {
  const list = document.getElementById('product-list');
  list.innerHTML = products.map(p => `
    <div class="product-card" data-barcode="${p.barcode}" data-serial="${p.serial || ''}">
      <img src="${p.image || 'https://via.placeholder.com/100'}"
        onclick='addToCart(${JSON.stringify(p)})' alt="" />
      <div class="product-name"><strong>${p.name}</strong></div>
      <div>‡∏ø${p.price}</div>
    </div>
  `).join('');
}

function addToCart(product) {
  const index = cart.findIndex(p => p.barcode === product.barcode);
  if (index !== -1) {
    cart[index].quantity += 1;
  } else {
    product.quantity = 1;
    cart.push(product);
  }
  updateCart();
}

function removeFromCart(barcode) {
  barcode = barcode.toString(); // ‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô string
  console.log("Removing item with barcode:", barcode);

  const index = cart.findIndex(p => p.barcode.toString() === barcode);
  if (index !== -1) {
    cart[index].quantity -= 1;
    console.log(`New quantity of ${cart[index].name}:`, cart[index].quantity);
    if (cart[index].quantity <= 0) {
      cart.splice(index, 1);
    }
  }
  updateCart();
}
function updateCart() {
  const cartBox = document.getElementById('cart-items');
  const total = document.getElementById('total');
  cartBox.innerHTML = '';
  let sum = 0;
  document.getElementById('clear-cart').onclick = function () {
  cart = [];
  updateCart();
};
  console.log("Current cart:", cart); // üëà ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ

  cart.forEach(item => {
    cartBox.innerHTML += `
      <div>
        ${item.name} x${item.quantity} - ‡∏ø${(item.price * item.quantity).toFixed(2)}
        <button class="remove-btn" onclick="removeFromCart('${item.barcode.toString()}')">‡∏•‡∏ö</button>
      </div>`;
    sum += item.price * item.quantity;
  });

  total.textContent = `‡∏ø${sum.toFixed(2)}`;
}
      function showPaymentModal() {
        document.getElementById('payment-total').innerText = document.getElementById('total').innerText;
        cashReceived = "";
        updateCashDisplay();
        document.getElementById('payment-modal').style.display = 'block';
      }

      function closeModal() {
        document.getElementById('payment-modal').style.display = 'none';
      }

      function appendDigit(digit) {
        if (digit === '.' && cashReceived.includes('.')) return;
        cashReceived += digit;
        updateCashDisplay();
      }

      function appendAmount(amount) {
        let current = Number(cashReceived) || 0;
        current += amount;
        cashReceived = current.toFixed(2);
        updateCashDisplay();
      }

      function clearCash() {
        cashReceived = "";
        updateCashDisplay();
      }

      function fillExactTotal() {
        const total = Number(document.getElementById('total').textContent);
        cashReceived = total.toFixed(2);
        updateCashDisplay();
      }

function updateCashDisplay() {
  const cash = Number(cashReceived) || 0;
  const discount = Number(document.getElementById('manual-discount')?.value || 0);

  document.getElementById('cash-display').innerText = cash.toFixed(2);

  const totalText = document.getElementById('total').textContent.replace(/[^\d.]/g, '');
  const originalTotal = Number(totalText);
  const discountedTotal = Math.max(originalTotal - discount, 0);

  const change = cash - discountedTotal;
  document.getElementById('change-amount').innerText = change.toFixed(2);

  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î
  document.getElementById('payment-total').innerText = discountedTotal.toFixed(2);
}

      function showSuccessPopup(change) {
        document.getElementById('popup-change').innerText = change.toFixed(2);
        const popup = document.getElementById('success-popup');
        popup.style.display = 'block';
        setTimeout(() => popup.style.display = 'none', 2500);
      }  
function payExact() {
  const totalText = document.getElementById('total').textContent.replace(/[^\d.]/g, '');
  const discount = Number(document.getElementById('manual-discount')?.value || 0);
  const total = Math.max(parseFloat(totalText) - discount, 0);
  cashReceived = total.toFixed(2);
  updateCashDisplay();
}
function submitPayment() {
  const received = Number(cashReceived);
  const discount = Number(document.getElementById('manual-discount')?.value || 0);

  const totalText = document.getElementById('total').textContent.replace(/[^\d.]/g, '');
  const originalTotal = Number(totalText);
  const total = Math.max(originalTotal - discount, 0);

  const change = received - total;

  if (received < total) {
    alert('‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠');
    return;
  }

  google.script.run.withSuccessHandler(() => {
    showReceipt(cart, received, change, selectedMethod);
    google.script.run.updateStockQuantityAfterSale(cart);
    cart = [];
    updateCart();
    cashReceived = "";
    document.getElementById('manual-discount').value = 0;
    updateCashDisplay();
    closeModal();
    showSuccessPopup(change);
  }).saveSale(cart, received, change, selectedMethod);
}

  function filterProducts() {
  const input = document.getElementById("searchInput").value.toLowerCase();
  const cards = document.querySelectorAll(".product-card"); // ‡∏ï‡∏±‡πâ‡∏á class ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å product ‡πÄ‡∏õ‡πá‡∏ô .product-card

  cards.forEach(card => {
    const name = card.textContent.toLowerCase();
    card.style.display = name.includes(input) ? "block" : "none";
  });
}

document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.pay-method').forEach(btn => {
          btn.addEventListener('click', function () {
            document.querySelectorAll('.pay-method').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            selectedMethod = this.dataset.method;

            if (selectedMethod === "‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô") {
              showQRPromptPay();
            } else {
              closeQRModal();
            }
          });
        });
      });


function goTo(section) {
  document.getElementById("section-pos").classList.add("hidden");
  document.getElementById("stock-section").classList.add("hidden");
  document.getElementById("section-report").classList.add("hidden");

  document.getElementById("section-" + section).classList.remove("hidden");
}
// ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏á‡∏¥‡∏ô
document.addEventListener('keydown', function (e) {
  const modal = document.getElementById('payment-modal');
  if (modal.style.display !== 'block') return;
    if (document.activeElement.tagName === 'INPUT') return; // ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á input ‡πÉ‡∏î‡πÜ ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°


  const key = e.key;

  if (!isNaN(key)) {
    // ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 0-9
    appendDigit(key);
  } else if (key === '.') {
    appendDigit('.');
  } else if (key === 'Backspace') {
    // ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
    e.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô browser ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
    cashReceived = cashReceived.slice(0, -1);
    updateCashDisplay();
  } else if (key === 'Enter') {
    // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
    submitPayment();
  }
});
document.getElementById("searchInput").addEventListener("input", function () {
  const keyword = this.value.toLowerCase();
  document.querySelectorAll(".product-card").forEach(card => {
    const name = card.querySelector(".product-name").textContent.toLowerCase();
    const barcode = card.dataset.barcode;
    const serial = card.dataset.serial;
    if (name.includes(keyword) || barcode.includes(keyword) || serial.includes(keyword)) {
      card.style.display = "";
    } else {
      card.style.display = "none";
    }
  });
});

function searchAndAddToCart() {
  const input = document.getElementById("searchInput").value.toLowerCase();
  const cards = document.querySelectorAll(".product-card");
  let found = false;

  cards.forEach(card => {
    const name = card.querySelector(".product-name").textContent.toLowerCase();
    const barcode = card.dataset.barcode;
    const serial = card.dataset.serial;
    if (name.includes(input) || barcode.includes(input) || serial.includes(input)) {
      card.scrollIntoView({ behavior: "smooth", block: "center" });
      card.click();
      found = true;
    }
  });

  if (!found) alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤");
}
       let cartItems = [];

  function updateCartDisplay() {
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
    // (‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß)
  }

  function clearCart() {
    cartItems = [];
    updateCartDisplay();
  }
function holdBill() {
  if (cart.length === 0) {
    showCenterAlert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏±‡∏Å‡∏ö‡∏¥‡∏•‡πÑ‡∏î‡πâ");
    return;
  }

  const heldBills = JSON.parse(localStorage.getItem('heldBills')) || [];
  const timestamp = new Date().toISOString();
  heldBills.push({ cart, timestamp });
  localStorage.setItem('heldBills', JSON.stringify(heldBills));

  cart = [];
  updateCart();
  updateHoldBillCount(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°
}
function updateHoldBillCount() {
  const heldBills = JSON.parse(localStorage.getItem('heldBills')) || [];
  const btn = document.getElementById('hold-bill-btn');
  btn.innerText = `üì• ‡∏û‡∏±‡∏Å‡∏ö‡∏¥‡∏• (${heldBills.length})`;
}

window.addEventListener('load', updateHoldBillCount);

function showRecallBillPopup() {
  const heldBills = JSON.parse(localStorage.getItem('heldBills')) || [];
  if (heldBills.length === 0) {
    showCenterAlert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏¥‡∏•‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÑ‡∏ß‡πâ");
    return;
  }

 let popup = document.createElement("div");
popup.id = "recall-popup";
popup.style.position = "fixed";
popup.style.top = "50%";
popup.style.left = "50%";
popup.style.transform = "translate(-50%, -50%)";
popup.style.background = "#eaffea"; // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô
popup.style.padding = "25px";
popup.style.borderRadius = "16px";
popup.style.boxShadow = "0 8px 20px rgba(0, 128, 0, 0.2)";
popup.style.zIndex = 9999;
popup.style.maxHeight = "80vh";
popup.style.overflowY = "auto";
popup.style.minWidth = "260px";
popup.style.textAlign = "center";

popup.innerHTML = `<h3 style="color:#2e7d32; margin-top:0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏¥‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å</h3>`;

heldBills.forEach((bill, index) => {
  const time = new Date(bill.timestamp).toLocaleString();
  const btn = document.createElement("button");
  btn.innerText = `üßæ ‡∏ö‡∏¥‡∏• ${index + 1} - ${time}`;
  btn.style.display = "block";
  btn.style.margin = "10px 0";
  btn.style.width = "100%";
  btn.style.padding = "12px";
  btn.style.borderRadius = "8px";
  btn.style.border = "1px solid #a5d6a7";
  btn.style.backgroundColor = "#ffffff";
  btn.style.color = "#2e7d32";
  btn.style.fontWeight = "bold";
  btn.style.cursor = "pointer";
  btn.style.transition = "background-color 0.3s ease";
  btn.onmouseover = () => btn.style.backgroundColor = "#c8e6c9";
  btn.onmouseout = () => btn.style.backgroundColor = "#ffffff";

  btn.onclick = () => {
    cart = [...bill.cart]; // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ö‡∏¥‡∏•‡∏°‡∏≤‡πÉ‡∏™‡πà cart
    heldBills.splice(index, 1); // ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å list
    localStorage.setItem("heldBills", JSON.stringify(heldBills));
    updateCart();
    updateHoldBillCount();
    popup.remove();
  };

  popup.appendChild(btn);
});

  const cancelBtn = document.createElement("button");
  cancelBtn.innerText = "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å";
  cancelBtn.style.marginTop = "10px";
  cancelBtn.style.background = "red";
  cancelBtn.style.color = "white";
  cancelBtn.style.padding = "8px 16px";
  cancelBtn.style.borderRadius = "8px";
  cancelBtn.onclick = () => popup.remove();
cancelBtn.onmouseover = () => cancelBtn.style.backgroundColor = "#c62828"; // ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏°
cancelBtn.onmouseout = () => cancelBtn.style.backgroundColor = "#e53935"; // ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏µ‡πÄ‡∏î‡∏¥‡∏°
  popup.appendChild(cancelBtn);
  document.body.appendChild(popup);
}
window.onload = function () {
  updateHoldBillCount();
  updateCart(); // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
};

function updateCart() {
  const cartBox = document.getElementById('cart-items');
  const total = document.getElementById('total');
  cartBox.innerHTML = '';
  let sum = 0;
  let totalItems = cart.length;
  let totalQuantity = 0;

  document.getElementById('clear-cart').onclick = function () {
    cart = [];
    updateCart();
  };

  cart.forEach(item => {
    const itemTotal = item.price * item.quantity;
    totalQuantity += item.quantity;

    cartBox.innerHTML += `
      <div>
        ${item.name} x${item.quantity} - ‡∏ø${itemTotal.toFixed(2)}
        <button class="remove-btn" onclick="removeFromCart('${item.barcode.toString()}')">‡∏•‡∏ö</button>
      </div>`;

    sum += itemTotal;
  });

  total.textContent = `‡∏ø${sum.toFixed(2)}`;
  document.getElementById('item-count').innerText = totalItems;
  document.getElementById('product-quantity').innerText = totalQuantity;
}

google.script.run.withSuccessHandler(renderProducts).getProducts();

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
      document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.pay-method').forEach(btn => {
          btn.addEventListener('click', function () {
            document.querySelectorAll('.pay-method').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            selectedMethod = this.dataset.method;

            if (selectedMethod === "‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô") {
              showQRPromptPay();
            } else {
              closeQRModal();
            }
          });
        });
      });

function showQRPromptPay() {
  const totalText = document.getElementById('total').textContent.replace(/[^\d.]/g, '');
  const discount = Number(document.getElementById('manual-discount')?.value || 0);
  const amount = Math.max(parseFloat(totalText) - discount, 0).toFixed(2); // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥

  const promptPayID = "1559900307139"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏±‡∏ï‡∏£ ‡∏õ‡∏ä‡∏ä. ‡∏à‡∏£‡∏¥‡∏á
  const url = "https://promptpay.io/" + promptPayID + "/" + amount;

  document.getElementById("promptpay-img").src = url;
  document.getElementById("qr-amount").innerText = "‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞: ‡∏ø" + amount;
  document.getElementById("promptpay-modal").style.display = "block";
}

      
      function generatePromptPayPayload(id, amount) {
        const payload = [
          '000201',
          '010212',
          '29370016A000000677010111',
          `01130066${id}`,
          '5303764',
          '5802TH',
          `5406${(parseFloat(amount) * 100).toFixed(0)}`,
          '6304'
        ].join('');
        return payload + getCRC16(payload);
      }

      function getCRC16(payload) {
        let crc = 0xFFFF;
        for (let i = 0; i < payload.length; i++) {
          crc ^= payload.charCodeAt(i) << 8;
          for (let j = 0; j < 8; j++) {
            if ((crc & 0x8000) !== 0) {
              crc = (crc << 1) ^ 0x1021;
            } else {
              crc <<= 1;
            }
            crc &= 0xFFFF;
          }
        }
        return crc.toString(16).toUpperCase().padStart(4, '0');
      }
function confirmPromptPayPayment() {
  const totalText = document.getElementById('total').textContent.replace(/[^\d.]/g, '');
  const discount = Number(document.getElementById('manual-discount')?.value || 0);
  const total = Math.max(parseFloat(totalText) - discount, 0).toFixed(2);

  cashReceived = total;
  updateCashDisplay();
  closeQRModal();
  submitPayment(); // ‚úÖ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ!
}

function showReceipt(cart, received, change, method) {
  const now = new Date();
  const receiptId = "R" + now.getTime();
  const dateStr = now.toLocaleString("th-TH");
  let html = `
    <p>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${dateStr}</p>
    <p>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à: ${receiptId}</p>
    <p>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢: -</p>
    <hr />
  `;
  let total = 0;
  const discount = Number(document.getElementById('manual-discount')?.value || 0);
  cart.forEach(item => {
    const line = `${item.quantity} x ${item.name} @ ${item.price} = ${(item.quantity * item.price).toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
    html += `<p>${line}</p>`;
    total += item.quantity * item.price;
  });
  const netTotal = Math.max(total - discount, 0);

  document.getElementById("receipt-details").innerHTML = html;
  document.getElementById("receipt-total").innerText = total.toFixed(2);
  document.getElementById("receipt-discount").innerText = discount.toFixed(2);
  document.getElementById("receipt-nettotal").innerText = netTotal.toFixed(2);
  document.getElementById("receipt-method").innerText = method;
  document.getElementById("receipt-received").innerText = received.toFixed(2);
  document.getElementById("receipt-change").innerText = change.toFixed(2);

  document.getElementById("receipt-modal").style.display = "block";
}


function downloadReceiptImage() {
  html2canvas(document.getElementById("receipt-content")).then(canvas => {
    const link = document.createElement("a");
    link.download = "receipt.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}
function printAndClose() {
  const printButtons = document.querySelectorAll('.no-print');
  printButtons.forEach(btn => btn.style.display = 'none'); // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå

  const receipt = document.getElementById("receipt-content").innerHTML;

  const printWindow = window.open('', '', 'width=600,height=800');
  printWindow.document.write(`
    <html>
      <head>
        <title>‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</title>
        <style>
          body { font-family: sans-serif; padding: 20px; }
        </style>
      </head>
      <body onload="window.print(); window.onafterprint = window.close();">
        ${receipt}
      </body>
    </html>
  `);
  printWindow.document.close();

  setTimeout(() => {
    printButtons.forEach(btn => btn.style.display = ''); // ‡πÇ‡∏ä‡∏ß‡πå‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
    document.getElementById("receipt-modal").style.display = "none";
  }, 500);
}


function downloadReceiptImageAndClose() {
  const printButtons = document.querySelectorAll('.no-print');
  printButtons.forEach(btn => btn.style.display = 'none'); // ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏û

  html2canvas(document.getElementById("receipt-content")).then(canvas => {
    const link = document.createElement("a");
    link.download = "receipt.png";
    link.href = canvas.toDataURL();
    link.click();

    setTimeout(() => {
      printButtons.forEach(btn => btn.style.display = ''); // ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
      document.getElementById("receipt-modal").style.display = "none";
    }, 500);
  });
}


function clearDiscount() {
  document.getElementById('manual-discount').value = 0;
  updateCashDisplay();
}
document.getElementById('manual-discount')?.addEventListener('input', updateCashDisplay);

function closeQRModal() {
  document.getElementById("promptpay-modal").style.display = "none";
}

////‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤///
function showPage(page) {
  document.getElementById("section-pos").style.display = 'none';
  document.getElementById("stock-section").style.display = 'none';
  document.getElementById("section-report").style.display = 'none';

  // ‚úÖ ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
  document.querySelector(".cart").style.display = "none";

  if (page === 'sale') {
    document.getElementById("section-pos").style.display = 'block';
    document.querySelector(".cart").style.display = "flex"; // ‚úÖ ‡πÇ‡∏ä‡∏ß‡πå‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢
  } else if (page === 'stock') {
    document.getElementById("stock-section").style.display = 'block';
    loadStock?.();
  } else if (page === 'report') {
    document.getElementById("section-report").style.display = 'block';
  }

  // ‚úÖ ‡∏à‡∏±‡∏î active ‡∏õ‡∏∏‡πà‡∏° sidebar
  document.querySelectorAll(".sidebar button").forEach(btn => btn.classList.remove("active"));
  const activeBtn = document.getElementById("btn-" + page);
  if (activeBtn) activeBtn.classList.add("active");
}



function loadStock() {
  google.script.run.withSuccessHandler(renderStock).getStockItems();
}
function renderStock(items) {
  const container = document.getElementById("stock-list");
  container.innerHTML = "";

  items.forEach(p => {
    const card = document.createElement("div");
    card.className = "stock-card";

    const img = document.createElement("img");
    img.src = "https://via.placeholder.com/100"; // Default image

    if (p.image) {
      fetch(p.image)
        .then(res => res.text())
        .then(url => {
          img.src = url;
        })
        .catch(() => {
          img.src = "https://via.placeholder.com/100";
        });
    }

    // ‚úÖ ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    img.onclick = () => openEditProductModal(p);

    const name = document.createElement("div");
    name.className = "stock-name";
    name.innerHTML = `<strong>${p.name}</strong>`;

    const qty = document.createElement("div");
    qty.className = "stock-qty";
    qty.innerText = `‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${p.quantity}`;

    card.appendChild(img);
    card.appendChild(name);
    card.appendChild(qty);
    container.appendChild(card);
  });
}


    function updateStock(barcode, delta) {
      google.script.run.withSuccessHandler(() => {
        const el = document.getElementById(`stock-${barcode}`);
        if (el) el.innerText = Number(el.innerText) + delta;
      }).updateStockQuantity(barcode, delta);
    }

function showAddProductModal(barcodeValue) {
  document.getElementById("add-product-modal").style.display = "block";

  const barcodeField = document.getElementById("new-barcode");
  barcodeField.value = barcodeValue;

  // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á barcode ‡∏î‡πâ‡∏ß‡∏¢ JsBarcode
  JsBarcode("#barcode-svg", barcodeValue, {
    format: "CODE128",
    lineColor: "#000",
    width: 2,
    height: 60,
    displayValue: true
  });
}



function closeAddProductModal() {
  document.getElementById("add-product-modal").style.display = "none";
}

function submitNewProduct() {
  const name = document.getElementById("new-name").value;
  const price = parseFloat(document.getElementById("new-price").value);
  const cost = parseFloat(document.getElementById("new-cost").value);
  const quantity = parseInt(document.getElementById("new-quantity").value);
  const barcode = document.getElementById("new-barcode").value;
  const fileInput = document.getElementById("new-image-file");
  const file = fileInput.files[0];

  if (!name || !price || !cost || !quantity || !barcode) {
    showCustomAlert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }

  if (!file) {
    showCustomAlert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const base64 = e.target.result.split(",")[1];
    const fileData = {
      name: file.name,
      type: file.type,
      content: base64,
      product: { name, price, cost, quantity, barcode }
    };

    google.script.run.withSuccessHandler(() => {
      // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡πá‡∏≠‡∏õ‡∏≠‡∏±‡∏õ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏≠ 500ms ‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏¥‡∏î modal
      showCustomAlert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");

      setTimeout(() => {
        clearAddProductForm();
        closeAddProductModal();
        loadStock();
        google.script.run.withSuccessHandler(renderProducts).getProducts();
      }, 500);
    }).uploadProductImageAndSave(fileData);
  };
  reader.readAsDataURL(file);
}

function showCustomAlert(message) {
  document.getElementById("custom-alert-message").innerText = message;
  const alertBox = document.getElementById("custom-alert");
  alertBox.style.display = "block";
}
function showCustomAlert(message) {
  document.getElementById("custom-alert-message").innerText = message;
  const alertBox = document.getElementById("custom-alert");
  alertBox.style.display = "block";

  // ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏Å‡∏î ‚Äú‡∏ï‡∏Å‡∏•‡∏á‚Äù ‡∏Å‡πá‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  setTimeout(() => {
    if (alertBox.style.display === "block") {
      alertBox.style.display = "none";
    }
  }, 2000);
}

function closeCustomAlert() {
  document.getElementById("custom-alert").style.display = "none";
}
function clearAddProductForm() {
  document.getElementById("new-name").value = "";
  document.getElementById("new-price").value = "";
  document.getElementById("new-cost").value = "";
  document.getElementById("new-quantity").value = "";
  document.getElementById("new-barcode").value = "";
  document.getElementById("new-image-file").value = "";
}

//Modal ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤//
function openEditProductModal(product) {
  document.getElementById("edit-name").value = product.name;
  document.getElementById("edit-price").value = product.price;
  document.getElementById("edit-cost").value = product.cost;
  document.getElementById("edit-quantity").value = product.quantity;
  document.getElementById("edit-barcode").value = product.barcode;

  // üü¢ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ
 document.getElementById("edit-quantity").dataset.originalQty = product.quantity;
  document.getElementById("edit-in").value = 0;
  document.getElementById("edit-out").value = 0;

  document.getElementById("edit-product-modal").style.display = "block";
}

function updateStockPreview() {
  const baseQty = parseInt(document.getElementById("edit-quantity").dataset.originalQty || "0");
  const inputIn = parseInt(document.getElementById("edit-in").value || "0");
  const inputOut = parseInt(document.getElementById("edit-out").value || "0");
  const result = baseQty + inputIn - inputOut;
  document.getElementById("edit-quantity").value = result < 0 ? 0 : result;
}

function closeEditProductModal() {
  document.getElementById("edit-product-modal").style.display = "none";
}

function submitEditProduct() {
  const barcode = document.getElementById("edit-barcode").value;
  const name = document.getElementById("edit-name").value;
  const price = parseFloat(document.getElementById("edit-price").value);
  const cost = parseFloat(document.getElementById("edit-cost").value);
  const quantity = parseInt(document.getElementById("edit-quantity").value);
  const file = document.getElementById("edit-image-file").files[0];

  if (!name || isNaN(price) || isNaN(cost) || isNaN(quantity)) {
    showCustomAlert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
    return;
  }

  const updateData = {
    barcode, name, price, cost, quantity
  };

  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      const base64 = e.target.result.split(",")[1];
      updateData.image = {
        name: file.name,
        type: file.type,
        content: base64
      };
      google.script.run.withSuccessHandler(() => {
        closeEditProductModal();
        showCustomAlert("‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        loadStock();
        google.script.run.withSuccessHandler(renderProducts).getProducts();
      }).updateProductWithImage(updateData);
    };
    reader.readAsDataURL(file);
  } else {
    google.script.run.withSuccessHandler(() => {
      closeEditProductModal();
      showCustomAlert("‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      loadStock();
      google.script.run.withSuccessHandler(renderProducts).getProducts();
    }).updateProduct(updateData);
  }
}
function updateStockPreview() {
  const baseQty = parseInt(document.getElementById("edit-quantity").dataset.originalQty || "0");
  const inputIn = parseInt(document.getElementById("edit-in").value || "0");
  const inputOut = parseInt(document.getElementById("edit-out").value || "0");
  const result = baseQty + inputIn - inputOut;

  document.getElementById("edit-quantity").value = result < 0 ? 0 : result;
}
////// ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î/////////
let html5QrCode;

function showBarcodeTypeModal() {
  document.getElementById("barcode-type-modal").style.display = "block";
  document.getElementById("manual-barcode").value = "";
}

function cancelBarcodeTypeModal() {
  stopScan();
  document.getElementById("barcode-type-modal").style.display = "none";
  clearAddProductForm(); // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
}

function confirmBarcodeType() {
  const option = document.querySelector('input[name="barcode-option"]:checked').value;
  let barcode = "";

  if (option === 'yes') {
    barcode = document.getElementById("manual-barcode").value.trim();
    if (!barcode) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î");
      return;
    }
  } else {
    barcode = generateBarcode13Digit(); // ‚úÖ ‡πÅ‡∏ó‡∏ô Date.now().slice(-8)
  }

  stopScan();
  document.getElementById("barcode-type-modal").style.display = "none";
  showAddProductModal(barcode);
}



function startScan() {
  document.getElementById("scan-area").style.display = "block";
  html5QrCode = new Html5Qrcode("reader");

  Html5Qrcode.getCameras().then(devices => {
    if (devices && devices.length) {
      html5QrCode.start(
        devices[0].id,
        { fps: 10, qrbox: 250 },
        decodedText => {
          document.getElementById("manual-barcode").value = decodedText;
          stopScan();
        },
        error => {}
      );
    }
  }).catch(err => {
    alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï");
  });
}

function stopScan() {
  if (html5QrCode) {
    html5QrCode.stop().then(() => {
      html5QrCode.clear();
      document.getElementById("scan-area").style.display = "none";
    });
  }
}

//////////‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î13‡∏´‡∏•‡∏±‡∏Å////////////
function generateBarcode13Digit() {
  let base = Date.now().toString();
  base = base.slice(-10); // ‡πÄ‡∏≠‡∏≤‡πÄ‡∏•‡∏Ç timestamp ‡∏î‡πâ‡∏≤‡∏ô‡∏ó‡πâ‡∏≤‡∏¢
  while (base.length < 12) base = '0' + base;

  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì check digit ‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô EAN-13
  let sum = 0;
  for (let i = 0; i < 12; i++) {
    sum += parseInt(base.charAt(i)) * (i % 2 === 0 ? 1 : 3);
  }
  const checkDigit = (10 - (sum % 10)) % 10;
  return base + checkDigit.toString();
}



    </script>
  </body>
</html>
